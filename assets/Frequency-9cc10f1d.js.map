{"version":3,"file":"Frequency-9cc10f1d.js","sources":["../../src/pages/subcomponents/SoundGenerator.vue","../../src/pages/Frequency.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport type { GeneratorOscillatorType, Note, Generator } from '#types'\nimport { onBeforeUnmount, ref, watch } from 'vue'\nimport { closeSvg } from '#assets/svgs'\n\ndefineEmits<{\n\tdeleteGenerator: []\n}>()\n\n// eslint-disable-next-line vue/no-setup-props-destructure, vue/no-dupe-keys\nconst { generator } = defineProps<{\n\tgenerator: Generator\n}>()\n\n// Public Refs\nconst volume = ref(0.07)\nconst frequency = ref(440)\nconst oscillatorType = ref<GeneratorOscillatorType>('sine')\nconst noteName = ref<Note>('A')\nconst noteOctave = ref(4)\nconst noteOffset = ref(0)\nconst started = ref(false)\n\n// Private Variables\nlet audioContext!: AudioContext\nlet oscillator!: OscillatorNode\nlet gainNode!: GainNode\nlet initialized = false\nlet difference = 0\nlet noteIndex = 9\n\nconst twelthRoot = 2 ** (1 / 12)\nconst fixedNote = 440 // Standard tuning frequency of A4 for 12 tone equal temperment\n// prettier-ignore\nconst notes: Note[] = ['C', 'D♭', 'D', 'E♭', 'E', 'F', 'G♭', 'G', 'A♭', 'A', 'B♭', 'B']\n\nif (generator.generatorType === 'Frequency') {\n\twatch(frequency, () => {\n\t\tif (!initialized) {\n\t\t\tinitializeContext()\n\t\t}\n\n\t\toscillator.frequency.setValueAtTime(\n\t\t\tfrequency.value,\n\t\t\taudioContext.currentTime\n\t\t)\n\t})\n}\n\nwatch(noteOffset, (newValue, previousValue) => {\n\tif (!initialized) {\n\t\tinitializeContext()\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\tdifference = newValue - previousValue\n\tupdateNoteFrequency()\n\n\tif (difference > 0) {\n\t\tincrementNote('Up')\n\t} else {\n\t\t// get absolute value of the difference when its negative\n\t\t// so we can easily recursive call in incrementNote()\n\t\tdifference = Math.abs(difference)\n\t\tincrementNote('Down')\n\t}\n})\n\nwatch(volume, () => {\n\tif (!initialized) {\n\t\tinitializeContext()\n\t}\n\n\tif (started.value) {\n\t\toscillator.disconnect()\n\t\tgainNode.gain.setValueAtTime(volume.value, audioContext.currentTime)\n\t\toscillator.connect(gainNode).connect(audioContext.destination)\n\t} else {\n\t\tgainNode.gain.setValueAtTime(volume.value, audioContext.currentTime)\n\t}\n})\n\nwatch(oscillatorType, () => {\n\tif (!initialized) {\n\t\tinitializeContext()\n\t}\n\n\tif (started.value) {\n\t\toscillator.disconnect()\n\t\toscillator.type = oscillatorType.value\n\t\toscillator.connect(gainNode).connect(audioContext.destination)\n\t} else {\n\t\toscillator.type = oscillatorType.value\n\t}\n})\n\n// Lifecycle Hooks\nonBeforeUnmount(() => {\n\toscillator?.disconnect()\n})\n\nfunction startStopButton() {\n\tstarted.value = !started.value\n\tif (!initialized) {\n\t\tinitializeContext()\n\t}\n\n\tif (started.value) {\n\t\toscillator.connect(gainNode).connect(audioContext.destination)\n\t} else {\n\t\toscillator.disconnect()\n\t}\n}\n\nfunction toPercent(value: number) {\n\treturn parseFloat((value * 2 * 100).toFixed(1))\n}\n\nfunction initializeContext() {\n\t// Audio contexts must be created by user gesture\n\t// so if this is the first press of the button create the contexts and if not ignore\n\taudioContext = new AudioContext()\n\n\tgainNode = new GainNode(audioContext, {\n\t\tgain: volume.value\n\t})\n\n\toscillator = new OscillatorNode(audioContext, {\n\t\ttype: oscillatorType.value,\n\t\tfrequency: frequency.value\n\t})\n\n\toscillator.start()\n\toscillator.connect(audioContext.destination)\n\toscillator.disconnect()\n\tinitialized = true\n}\n\nfunction incrementNote(increment: 'Up' | 'Down') {\n\tdo {\n\t\tif (increment === 'Up') {\n\t\t\tif (noteIndex === 11) {\n\t\t\t\tnoteOctave.value++\n\t\t\t\tnoteIndex = 0\n\t\t\t} else {\n\t\t\t\tnoteIndex++\n\t\t\t}\n\t\t} else {\n\t\t\tif (noteIndex === 0) {\n\t\t\t\tnoteOctave.value--\n\t\t\t\tnoteIndex = 11\n\t\t\t} else {\n\t\t\t\tnoteIndex--\n\t\t\t}\n\t\t}\n\t\tnoteName.value = notes[noteIndex]\n\t\tdifference--\n\t} while (difference > 0)\n}\n\nfunction updateNoteFrequency() {\n\tfrequency.value = parseFloat(\n\t\t// From here: https://pages.mtu.edu/~suits/NoteFreqCalcs.html\n\t\t(fixedNote * twelthRoot ** noteOffset.value).toFixed(4)\n\t)\n\toscillator.frequency.setValueAtTime(frequency.value, audioContext.currentTime)\n}\n</script>\n\n<template>\n\t<div class=\"tw-card bg-[#424242] p-4 w-4/5\">\n\t\t<svg\n\t\t\tclass=\"h-6 float-right cursor-pointer\"\n\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t@click=\"$emit('deleteGenerator')\"\n\t\t>\n\t\t\t<path fill=\"currentColor\" :d=\"closeSvg\" />\n\t\t</svg>\n\n\t\t<div class=\"flex flex-col\">\n\t\t\t<div class=\"m-0 p-4\">\n\t\t\t\t<div v-if=\"generator.generatorType === 'Frequency'\">\n\t\t\t\t\tFrequency: {{ frequency }}\n\t\t\t\t\t<input\n\t\t\t\t\t\tid=\"range-1\"\n\t\t\t\t\t\tv-model=\"frequency\"\n\t\t\t\t\t\tclass=\"w-full h-6 bg-transparent\"\n\t\t\t\t\t\ttype=\"range\"\n\t\t\t\t\t\tmin=\"10\"\n\t\t\t\t\t\tmax=\"22000\"\n\t\t\t\t\t\tstep=\"10\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- @input=\"$emit('updateSettings', 'frequency', ($event.target! as any).value)\" -->\n\n\t\t\t\t<div v-else-if=\"generator.generatorType === 'Note'\">\n\t\t\t\t\t<div class=\"h-6\">\n\t\t\t\t\t\tNote/ Frequency: {{ noteName }} <sub>{{ noteOctave }}</sub> /\n\t\t\t\t\t\t{{ frequency }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<input\n\t\t\t\t\t\tid=\"range-1\"\n\t\t\t\t\t\tv-model=\"noteOffset\"\n\t\t\t\t\t\tclass=\"w-full h-6 bg-transparent\"\n\t\t\t\t\t\ttype=\"range\"\n\t\t\t\t\t\tmin=\"-57\"\n\t\t\t\t\t\tmax=\"68\"\n\t\t\t\t\t\tstep=\"1\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\n\t\t\t\t<div>\n\t\t\t\t\tVolume: {{ toPercent(volume) }}%\n\t\t\t\t\t<input\n\t\t\t\t\t\tv-model=\"volume\"\n\t\t\t\t\t\tclass=\"w-full h-6 bg-transparent\"\n\t\t\t\t\t\ttype=\"range\"\n\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\tmax=\"1\"\n\t\t\t\t\t\tstep=\"0.0005\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\n\t\t\t\t<select\n\t\t\t\t\tv-model=\"oscillatorType\"\n\t\t\t\t\tclass=\"pt-2 pr-9 pb-2 pl-3 text-black border border-solid border-[#ced4da] rounded my-0 mx-auto flex justify-center\"\n\t\t\t\t>\n\t\t\t\t\t<option value=\"sawtooth\">Sawtooth</option>\n\t\t\t\t\t<option selected value=\"sine\">Sine</option>\n\t\t\t\t\t<option value=\"square\">Square</option>\n\t\t\t\t\t<option value=\"triangle\">Triangle</option>\n\t\t\t\t</select>\n\t\t\t</div>\n\n\t\t\t<div class=\"flex justify-center\">\n\t\t\t\t<button class=\"tw-button\" @click=\"startStopButton\">\n\t\t\t\t\t<template v-if=\"started\">Stop</template>\n\t\t\t\t\t<template v-else>Start</template>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</template>\n","<script setup lang=\"ts\">\nimport SoundGenerator from './subcomponents/SoundGenerator.vue'\nimport { closeSvg, addSvg } from '#assets/svgs'\nimport { onMounted, reactive, ref } from 'vue'\nimport type { GeneratorType, Generator } from '#types'\nimport { ClickOutsideDialog, DynamicImportDialogPolyfill } from '../shared'\n\nconst generators = reactive<Generator[]>([\n\t{\n\t\tid: 0,\n\t\tgeneratorType: 'Frequency'\n\t},\n\t{\n\t\tid: 1,\n\t\tgeneratorType: 'Note'\n\t}\n])\n\nconst generatorModal = ref<HTMLDialogElement>()\n\nonMounted(async () => {\n\tif (!generatorModal.value) {\n\t\tconsole.error('Release Modal does not exist: ', generatorModal.value)\n\t\treturn\n\t}\n\tawait DynamicImportDialogPolyfill([generatorModal.value])\n\tClickOutsideDialog(generatorModal.value)\n})\n\nfunction addGenerator(type: GeneratorType) {\n\tgenerators.push({\n\t\tid: generators.length > 0 ? generators[generators.length - 1].id + 1 : 0,\n\t\tgeneratorType: type\n\t})\n\tgeneratorModal.value?.close()\n}\n</script>\n\n<template>\n\t<div class=\"tw-flex-col-center\">\n\t\t<h1 class=\"m-4 mb-0 text-2xl font-semibold\">Frequency Generator</h1>\n\n\t\t<SoundGenerator\n\t\t\tv-for=\"(generator, index) in generators\"\n\t\t\t:key=\"generator.id\"\n\t\t\t:index=\"index\"\n\t\t\t:generator=\"generator\"\n\t\t\t@delete-generator=\"generators.splice(index, 1)\"\n\t\t/>\n\n\t\t<div class=\"flex justify-center\">\n\t\t\t<svg\n\t\t\t\tclass=\"w-[50px] cursor-pointer tw-button fill-white bg-neutral-500 mt-4 rounded-xl p-[2px]\"\n\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t@click=\"generatorModal?.showModal()\"\n\t\t\t>\n\t\t\t\t<path :d=\"addSvg\"></path>\n\t\t\t</svg>\n\t\t</div>\n\t</div>\n\n\t<dialog ref=\"generatorModal\" class=\"bg-transparent\">\n\t\t<div id=\"generatorModal\" class=\"text-neutral-300 bg-[#383838] w-72\">\n\t\t\t<div\n\t\t\t\tclass=\"flex justify-between p-4 border-b border-solid border-[#dee2e6]\"\n\t\t\t>\n\t\t\t\t<h5>Add a new generator</h5>\n\n\t\t\t\t<svg\n\t\t\t\t\tclass=\"h-6 cursor-pointer\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t@click=\"generatorModal?.close()\"\n\t\t\t\t>\n\t\t\t\t\t<path fill=\"currentColor\" :d=\"closeSvg\" />\n\t\t\t\t</svg>\n\t\t\t</div>\n\n\t\t\t<div class=\"p-4 flex gap-2 justify-center\">\n\t\t\t\t<button class=\"tw-button\" @click=\"addGenerator('Frequency')\">\n\t\t\t\t\tFrequency\n\t\t\t\t</button>\n\t\t\t\t<button class=\"tw-button\" @click=\"addGenerator('Note')\">Note</button>\n\t\t\t</div>\n\t\t</div>\n\t</dialog>\n</template>\n"],"names":["twelthRoot","fixedNote","volume","ref","frequency","oscillatorType","noteName","noteOctave","noteOffset","started","audioContext","oscillator","gainNode","initialized","difference","noteIndex","notes","__props","watch","initializeContext","newValue","previousValue","updateNoteFrequency","incrementNote","onBeforeUnmount","startStopButton","toPercent","value","increment","generators","reactive","generatorModal","onMounted","DynamicImportDialogPolyfill","ClickOutsideDialog","addGenerator","type"],"mappings":"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"}